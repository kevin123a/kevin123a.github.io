<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>VVIP Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Font Awesome (ikon) & Chart.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f7f7f9; --sidebar:#420D09; --accent:#FDC12A; --text:#222;
    }
    html{font-size:16px}
    body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;}
    .sidebar{width:260px;background:var(--sidebar);color:var(--accent);display:flex;flex-direction:column;padding:18px 0;gap:6px;box-shadow:2px 0 8px rgba(0,0,0,0.08);position:relative}
    .sidebar .logo{display:flex;flex-direction:column;align-items:center;margin-bottom:10px}
    .sidebar .logo img{width:44px;height:44px;border-radius:6px;margin-bottom:6px}
    .sidebar h2{margin:0;color:var(--accent);font-size:18px}
    .sidebar a{display:flex;align-items:center;padding:10px 18px;gap:10px;color:var(--accent);text-decoration:none;cursor:pointer;font-weight:600}
    .sidebar a:hover{background:rgba(253,193,42,0.12)}
    .submenu{display:none;flex-direction:column;padding-left:34px;background:rgba(253,193,42,0.03)}
    .submenu a{font-weight:500;padding:8px 18px;font-size:14px}
    .content{flex:1;padding:22px;overflow:auto}
    header.small{margin-bottom:18px;display:flex;justify-content:space-between;align-items:center}
    header.small h1{margin:0;color:var(--sidebar);font-size:20px}
    .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:18px}
    .kpi{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);text-align:center}
    .kpi h3{margin:0;font-size:13px;color:#666}
    .kpi p{margin:8px 0 0;font-size:20px;font-weight:800;color:var(--sidebar)}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
    th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
    th{background:var(--sidebar);color:var(--accent);font-weight:700}
    tr:last-child td{border-bottom:none}
    .progress{height:14px;background:#f0f0f0;border-radius:10px;overflow:hidden}
    .progress > i{display:block;height:100%;text-align:center;font-size:11px;color:var(--sidebar);font-weight:700}
    .row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.05)}
    .btn{background:var(--accent);color:var(--sidebar);padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .muted{color:#666;font-size:14px}
    .settings-row{display:flex;gap:8px;align-items:center;margin-top:10px}
    .toggle-mobile{display:none;position:fixed;left:8px;top:8px;background:var(--sidebar);color:var(--accent);border:none;padding:10px;border-radius:8px;z-index:1001}
    .emoji-elite{font-size:18px;margin-right:6px}
    @media (max-width:900px){
      .sidebar{position:fixed;left:-300px;top:0;height:100%;z-index:999;transition:all .25s}
      .sidebar.active{left:0}
      body.mobile-sidebar-open{overflow:hidden}
      .content{padding:12px}
      .toggle-mobile{display:inline-block}
    }
    .dark{--bg:#111;--sidebar:#111;--accent:#FFD559;--text:#eee}
    /* small helpers */
    .top-controls{display:flex;gap:8px;align-items:center}
    .small-muted{font-size:13px;color:#666}
    .price-up{color:#2e7d32;font-weight:700}
    .price-down{color:#c62828;font-weight:700}
  </style>
</head>
<body>
  <button class="toggle-mobile" onclick="document.getElementById('sidebar').classList.toggle('active')"><i class="fa fa-bars"></i></button>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <img src="logo.png" alt="logo"> <!-- small logo -->
      <h2>VVIP Dashboard</h2>
    </div>

    <a onclick="showContent('overview')"><i class="fa-solid fa-gauge-high emoji-elite"></i> Overview</a>
    <a onclick="showContent('projects')"><i class="fa-solid fa-briefcase emoji-elite"></i> Projects</a>
    <a onclick="showContent('clients')"><i class="fa-solid fa-users emoji-elite"></i> Clients</a>

    <a onclick="toggleMenu('financeSub')"><i class="fa-solid fa-sack-dollar emoji-elite"></i> Finance <i class="fa fa-caret-down" style="margin-left:auto"></i></a>
    <div class="submenu" id="financeSub">
      <a onclick="showContent('cashflow')">üí∞ Cashflow</a>
      <a onclick="showContent('tax')">üìä Tax</a>
      <a onclick="showContent('payroll')">üë• Payroll</a>
    </div>

    <a onclick="toggleMenu('contractsSub')"><i class="fa-solid fa-file-contract emoji-elite"></i> Contracts <i class="fa fa-caret-down" style="margin-left:auto"></i></a>
    <div class="submenu" id="contractsSub">
      <a onclick="showContent('drafts')">‚úèÔ∏è Drafts</a>
      <a onclick="showContent('signed')">‚úÖ Signed</a>
      <a onclick="showContent('archives')">üì¶ Archives</a>
    </div>

    <a onclick="showContent('compliance')"><i class="fa-solid fa-scale-balanced emoji-elite"></i> Compliance</a>

    <a onclick="toggleMenu('investmentSub')"><i class="fa-solid fa-lightbulb emoji-elite"></i> Investment <i class="fa fa-caret-down" style="margin-left:auto"></i></a>
    <div class="submenu" id="investmentSub">
      <a onclick="showContent('portfolio')">üìã Portfolio</a>
      <a onclick="showContent('IHSG')">üìà IHSG</a>
      <a onclick="showContent('crypto')">ü™ô Crypto (live)</a>
      <a onclick="showContent('gold')">üèÖ Gold</a>
      <a onclick="showContent('markets')">üåç Markets (Regional)</a>
    </div>

    <a onclick="showContent('reports')"><i class="fa-solid fa-chart-pie emoji-elite"></i> Reports</a>
    <a onclick="showContent('settings')"><i class="fa-solid fa-gears emoji-elite"></i> Settings</a>

    <hr style="margin:10px 0;border:0;border-top:1px solid rgba(255,255,255,0.12)">
    <a href="vvip-pro.html"><i class="fa-solid fa-crown emoji-elite"></i> VVIP Pro</a>
    <a href="vvip-plus.html"><i class="fa-solid fa-gem emoji-elite"></i> VVIP Plus</a>

    <div style="margin-top:auto;padding:12px;text-align:center" class="muted">
      <div style="font-weight:700"><img src="logo.png" style="width:16px;height:16px;margin-right:8px;vertical-align:middle"> PT Sinar Langit Hanoi</div>
      <div style="font-size:12px">Jl. Nakula, Tanjunganom, Nganjuk</div>
      <div style="margin-top:8px"><button class="btn" onclick="logout()"> Logout</button></div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="content" id="mainContent">
    <header class="small">
      <h1>VVIP Dashboard</h1>
      <div class="top-controls">
        <div class="small-muted">Font</div>
        <select id="fontSizeTop" onchange="applyFontSize()" title="Edit font size (EDIT DISINI)">
          <option value="14">14px</option>
          <option value="16" selected>16px</option>
          <option value="18">18px</option>
          <option value="20">20px</option>
        </select>
        <button class="btn" onclick="toggleDark()">üåô</button>
      </div>
    </header>

    <div id="viewArea"></div>
  </div>

  <script>
  /*****************************************
   *  DATA AREA - EDIT DISINI (GANTI DATA)
   *  Ubah angka / text di bawah untuk
   *  mengupdate tabel & chart otomatis.
   *****************************************/
  const DATA = {
    // Overview KPI
    overviewKPI: {
      clientsTotal: 40,        // EDIT DISINI
      projectsOngoing: 19,     // EDIT DISINI
      revenueGrowthPct: 15,   // EDIT DISINI
      complianceScore: 87     // EDIT DISINI
    },

    // Service distribution (pie)
    servicesDistribution: [ // EDIT DISINI
      {name: 'Personal Financial Management', value: 35},
      {name: 'Private Lending Solutions', value: 25},
      {name: 'Immigration Assistance', value: 20},
      {name: 'Business & SOP Consulting', value: 20}
    ],

    // Projects (EDIT DISINI)
    projects: [
      {name:'Personal Financial Management', status:'Active', progress:80, deadline:'2025-12'},
      {name:'Private Lending Solutions', status:'On Hold', progress:40, deadline:'2026-01'},
      {name:'Immigration Document Assistance', status:'Active', progress:65, deadline:'2025-11'},
      {name:'Business & SOP Consulting', status:'Planning', progress:25, deadline:'2026-03'}
    ],

    // Clients (EDIT DISINI)
    clients: [ 'Halora Store', 'Minimal K Group', 'Minimal SHP Indonesia', 'Deyuwa Silona' ],

    // Finance (EDIT DISINI)
    finance: {
      cashflow: { income: 60, expense: 30, saving: 10 }, // "EDIT DISINI persentase"
      taxStatus: 'Patuh',   // EDIT DISINI
      payrollNote: 'Gaji & detail bersifat rahasia. HR mengelola slip gaji setiap bulan.' // EDIT DISINI
    },

    // Contracts (EDIT DISINI suggested structure)
    contracts: {
      drafts: [
        {name:'Draft - Kerjasama A', note:'Butuh review legal & PIC'},
        {name:'Draft - Pinjaman B', note:'Pending tanda tangan klien'}
      ],
      signed: [
        {name:'MoU - PT ABC', date:'2024-01-15'}
      ],
      archives: [
        {name:'Kontrak Lama XYZ', note:'Selesai 2023'}
      ]
    },

    // Portfolio (juGa EDIT DISINI; lots shown as 'Rahasia')
    portfolio: [
      {symbol:'BJTM', lots:'Rahasia'},{symbol:'RUNS', lots:'Rahasia'},
      {symbol:'KOCI', lots:'Rahasia'},{symbol:'BCAP', lots:'Rahasia'},{symbol:'LPKR', lots:'Rahasia'}
    ],

    // MARKETS - editable arrays (simulasi). Ganti angka untuk update chart.
    // For real live indices you'll need a stock-data API (see comments below).
    markets: {
      IHSG: {name:'IHSG', history:[6900,7000,7100,7050,7200]},        // EDIT DISINI
      VN: {name:'VN-Index', history:[1200,1220,1210,1230,1245]},      // EDIT DISINI
      TH: {name:'SET', history:[1500,1510,1490,1520,1535]},          // EDIT DISINI
      SG: {name:'STI', history:[3200,3220,3210,3235,3250]},          // EDIT DISINI
      GOLD: {name:'Gold (USD/oz)', history:[1900,1910,1905,1920,1930]},// EDIT DISINI
      CRYPTO: {name:'BTCUSD', history:[60000,60500,60200,61000,61500]} // used as fallback; live crypto uses CoinGecko
    },

    // Reports (EDIT DISINI)
    reports: [
      {month:'Jan', revenue:'Rp 0', note:'EDIT DISINI'},
      {month:'Feb', revenue:'Rp 0', note:'EDIT DISINI'}
    ]
  };

  /*****************************************
   *  END DATA AREA
   *****************************************/

  // utilities
  function el(tag, attrs={}, inner=''){ const e = document.createElement(tag); for(let k in attrs) e.setAttribute(k,attrs[k]); if(inner) e.innerHTML = inner; return e; }

  // dispatcher
  function showContent(menu){
    document.getElementById('sidebar').classList.remove('active');
    const view = document.getElementById('viewArea');
    view.innerHTML = '';
    switch(menu){
      case 'overview': renderOverview(view); break;
      case 'projects': renderProjects(view); break;
      case 'clients': renderClients(view); break;
      case 'cashflow': renderCashflow(view); break;
      case 'tax': renderTax(view); break;
      case 'payroll': renderPayroll(view); break;
      case 'drafts': renderDrafts(view); break;
      case 'signed': renderSigned(view); break;
      case 'archives': renderArchives(view); break;
      case 'compliance': renderCompliance(view); break;
      case 'portfolio': renderPortfolio(view); break;
      case 'IHSG': renderIHSG(view); break;
      case 'crypto': renderCrypto(view); break;
      case 'gold': renderGold(view); break;
      case 'markets': renderMarkets(view); break;
      case 'reports': renderReports(view); break;
      case 'settings': renderSettings(view); break;
      default: view.innerHTML = '<h2>Page Not Found</h2>';
    }
  }

  function toggleMenu(id){ const el = document.getElementById(id); el.style.display = (el.style.display==='flex')?'none':'flex'; }

  // ---------- RENDERS ----------
  function renderOverview(target){
    target.innerHTML = `
      <div class="row">
        <div style="flex:1">
          <div class="kpi-grid">
            <div class="kpi"><h3>Clients üåê</h3><p>${DATA.overviewKPI.clientsTotal}</p></div>
            <div class="kpi"><h3>Projects üíº</h3><p>${DATA.overviewKPI.projectsOngoing} Ongoing</p></div>
            <div class="kpi"><h3>Revenue Growth üìà</h3><p>+${DATA.overviewKPI.revenueGrowthPct}%</p></div>
            <div class="kpi"><h3>Compliance ‚ú®</h3><p>${DATA.overviewKPI.complianceScore}%</p></div>
          </div>

          <div class="card" style="padding:12px;">
            <h3 style="margin:6px 0">Service Distribution</h3>
            <div style="max-width:700px;margin:auto"><canvas id="overviewPie"></canvas></div>
            <div style="margin-top:12px;text-align:center" class="muted">(Edit data di <b>DATA.servicesDistribution</b>)</div>
          </div>
        </div>
      </div>
    `;

    const ctx = document.getElementById('overviewPie').getContext('2d');
    const labels = DATA.servicesDistribution.map(s => s.name);
    const values = DATA.servicesDistribution.map(s => s.value);
    new Chart(ctx, {
      type:'doughnut',
      data:{labels, datasets:[{data:values,backgroundColor:['#FFD500','#FF6B6B','#4CAF50','#2196F3']}]},
      options:{plugins:{legend:{position:'bottom'}}}
    });
  }

  function renderProjects(target){
    let rows = '';
    DATA.projects.forEach(p=>{
      rows += `<tr>
        <td>${p.name}</td>
        <td>${p.status}</td>
        <td>
          <div class="progress"><i style="width:${p.progress}%;background:linear-gradient(90deg,#FFD500,#420D09);display:block;height:100%;"></i></div>
        </td>
        <td>${p.deadline}</td>
      </tr>`;
    });

    target.innerHTML = `
      <h2>Projects & Services</h2>
      <p class="muted">Daftar layanan & progress (EDIT DISINI -> DATA.projects)</p>
      <table><thead><tr><th>Service</th><th>Status</th><th>Progress</th><th>Deadline</th></tr></thead><tbody>${rows}</tbody></table>
    `;
  }

  function renderClients(target){
    const list = DATA.clients.map(c=>`<li>${c}</li>`).join('');
    target.innerHTML = `<h2>Clients</h2><ul>${list}</ul>`;
  }

  function renderCashflow(target){
    target.innerHTML = `
      <h2>Cashflow üí∞</h2>
      <p class="muted">Diagram arus kas (EDIT DISINI -> DATA.finance.cashflow)</p>
      <div style="max-width:600px"><canvas id="cashChart"></canvas></div>
    `;
    const ctx = document.getElementById('cashChart').getContext('2d');
    const cf = DATA.finance.cashflow;
    new Chart(ctx, {
      type:'pie',
      data:{labels:['Income','Expense','Saving'],datasets:[{data:[cf.income,cf.expense,cf.saving],backgroundColor:['#4CAF50','#FF6B6B','#FFD500']}]}
    });
  }

  function renderTax(target){
    target.innerHTML = `
      <h2>Tax üìä</h2>
      <p class="muted">Status pajak: <strong>${DATA.finance.taxStatus}</strong></p>
      <p>Biasanya berisi: jenis pajak terdaftar, tanggal pelaporan terakhir, PIC akuntansi, link SPT / bukti setor.</p>
      <div class="muted">(Edit DATA.finance.taxStatus)</div>
    `;
  }

  function renderPayroll(target){
    target.innerHTML = `
      <h2>Payroll üë•</h2>
      <p class="muted">${DATA.finance.payrollNote}</p>
      <p>Biasanya berisi: jadwal pembayaran, slip gaji, potongan & tunjangan. (Data sensitif => simpan di server aman)</p>
    `;
  }

  function renderDrafts(target){
    let rows = DATA.contracts.drafts.map(d=>`<tr><td>${d.name}</td><td>${d.note}</td></tr>`).join('');
    target.innerHTML = `<h2>Draft Contracts ‚úèÔ∏è</h2><p class="muted">Saran isi: nama klien, scope, PIC, deadline review.</p><table><thead><tr><th>Nama</th><th>Catatan</th></tr></thead><tbody>${rows}</tbody></table>`;
  }

  function renderSigned(target){
    let rows = DATA.contracts.signed.map(d=>`<tr><td>${d.name}</td><td>${d.date}</td></tr>`).join('');
    target.innerHTML = `<h2>Signed Contracts ‚úÖ</h2><table><thead><tr><th>Nama</th><th>Tanggal</th></tr></thead><tbody>${rows}</tbody></table>`;
  }

  function renderArchives(target){
    let rows = DATA.contracts.archives.map(d=>`<tr><td>${d.name}</td><td>${d.note}</td></tr>`).join('');
    target.innerHTML = `<h2>Archived Contracts üì¶</h2><table><thead><tr><th>Nama</th><th>Keterangan</th></tr></thead><tbody>${rows}</tbody></table>`;
  }

  function renderCompliance(target){
    target.innerHTML = `
      <h2>Compliance ‚ú®</h2>
      <p class="muted">Monitoring kepatuhan: pajak, ketenagakerjaan, izin usaha.</p>
      <div style="max-width:600px"><canvas id="compChart"></canvas></div>
    `;
    const ctx = document.getElementById('compChart').getContext('2d');
    new Chart(ctx,{
      type:'doughnut',
      data:{labels:['Pajak','Ketenagakerjaan','Izin Usaha'],datasets:[{data:[85,70,95],backgroundColor:['#FFD500','#FF6B6B','#4CAF50']}]},
      options:{plugins:{legend:{position:'bottom'}}}
    });
  }

  function renderPortfolio(target){
    const rows = DATA.portfolio.map(p=>`<tr><td>${p.symbol}</td><td style="font-weight:700">${p.lots}</td></tr>`).join('');
    target.innerHTML = `<h2>Portfolio üìã</h2><p class="muted">Jumlah lot disembunyikan (Rahasia)</p><table><thead><tr><th>Saham</th><th>Jumlah (Lot)</th></tr></thead><tbody>${rows}</tbody></table>`;
  }

  // ----- IHSG (simulasi using DATA.markets.IHSG) -----
  let ihsgChart;
  function renderIHSG(target){
    target.innerHTML = `
      <h2>IHSG (Simulasi)</h2>
      <p class="muted">Untuk data IHSG real-time: butuh data provider / API (lihat komentar di JS). Edit DATA.markets.IHSG untuk simulasi.</p>
      <button class="btn" onclick="refreshIHSG()">Refresh (simulasi)</button>
      <div style="max-width:900px;margin-top:12px"><canvas id="chartIHSG"></canvas></div>
    `;
    const ctx = document.getElementById('chartIHSG').getContext('2d');
    const arr = DATA.markets.IHSG.history;
    if(ihsgChart) ihsgChart.destroy();
    ihsgChart = new Chart(ctx, {
      type:'line',
      data:{labels:arr.map((_,i)=>i+1),datasets:[{label:DATA.markets.IHSG.name,data:arr,borderColor:'#420D09',fill:false}]},
      options:{plugins:{legend:{display:false}}}
    });
  }
  function refreshIHSG(){ renderIHSG(document.getElementById('viewArea')); }

  // ----- Crypto (LIVE via CoinGecko) -----
  // CoinGecko public API used (no api key). We fetch BTC & ETH prices in USD and IDR and plot live series.
  let cryptoChart;
  const CRYPTO_IDS = ['bitcoin','ethereum']; // EDIT DISINI to add more supported coins (CoinGecko IDs)
  const CRYPTO_INTERVAL = 10000; // 10s
  let cryptoSeries = {bitcoin: [], ethereum: []};
  let cryptoLabels = [];

  async function fetchCryptoPrices(){
    try{
      const ids = CRYPTO_IDS.join(',');
      const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd,idr&include_24hr_change=true`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      const now = new Date().toLocaleTimeString();
      cryptoLabels.push(now);
      if(cryptoLabels.length>20) cryptoLabels.shift();
      CRYPTO_IDS.forEach(id=>{
        const price = (data[id] && (data[id].idr || data[id].usd)) ? (data[id].idr || data[id].usd) : null;
        if(price !== null){
          cryptoSeries[id] = cryptoSeries[id] || [];
          cryptoSeries[id].push(price);
          if(cryptoSeries[id].length>20) cryptoSeries[id].shift();
        }
      });
      return {data, now};
    }catch(e){
      console.error('crypto fetch err', e);
      return null;
    }
  }

  async function renderCrypto(target){
    target.innerHTML = `
      <h2>Crypto (Live) ü™ô</h2>
      <p class="muted">Sumber: CoinGecko (gratis). Grafik auto-update tiap 10 detik.</p>
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px">
        <button class="btn" onclick="manualRefreshCrypto()">üîÑ Refresh Now</button>
        <div class="small-muted">Data: BTC & ETH (EDIT DATA CRYPTO IDS DI JS)</div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="card"><h4>BTC (IDR)</h4><div id="btcPrice" class="small-muted">Loading...</div><canvas id="chartBTC" style="max-height:220px"></canvas></div>
        <div class="card"><h4>ETH (IDR)</h4><div id="ethPrice" class="small-muted">Loading...</div><canvas id="chartETH" style="max-height:220px"></canvas></div>
      </div>
    `;

    // initialize empty charts
    createOrUpdateCryptoCharts();

    // fetch once + start interval
    await updateCryptoAndCharts();
    if(window._cryptoInterval) clearInterval(window._cryptoInterval);
    window._cryptoInterval = setInterval(updateCryptoAndCharts, CRYPTO_INTERVAL);
  }

  function createOrUpdateCryptoCharts(){
    const ctxB = document.getElementById('chartBTC').getContext('2d');
    const ctxE = document.getElementById('chartETH').getContext('2d');
    if(cryptoChart && cryptoChart.btc) { cryptoChart.btc.destroy(); cryptoChart.eth.destroy(); }
    cryptoChart = {};
    cryptoChart.btc = new Chart(ctxB, {type:'line', data:{labels:cryptoLabels, datasets:[{label:'BTC',data:cryptoSeries.bitcoin,borderColor:'#f4b400',fill:false}]}, options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}});
    cryptoChart.eth = new Chart(ctxE, {type:'line', data:{labels:cryptoLabels, datasets:[{label:'ETH',data:cryptoSeries.ethereum,borderColor:'#6f42c1',fill:false}]}, options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}});
  }

  async function updateCryptoAndCharts(){
    const r = await fetchCryptoPrices();
    if(!r){ document.getElementById('btcPrice').innerText = 'Gagal mengambil data.'; document.getElementById('ethPrice').innerText = 'Gagal mengambil data.'; return; }
    const data = r.data;
    // update price display (prefers IDR if present)
    if(data.bitcoin){
      const p = data.bitcoin.idr || data.bitcoin.usd;
      document.getElementById('btcPrice').innerHTML = `<span style="font-weight:700">Rp ${formatNumber(p)}</span> <span class="small-muted">(${data.bitcoin.usd?('$'+data.bitcoin.usd):''})</span>`;
    }
    if(data.ethereum){
      const p = data.ethereum.idr || data.ethereum.usd;
      document.getElementById('ethPrice').innerHTML = `<span style="font-weight:700">Rp ${formatNumber(p)}</span> <span class="small-muted">(${data.ethereum.usd?('$'+data.ethereum.usd):''})</span>`;
    }
    // update charts (recreate for simplicity)
    createOrUpdateCryptoCharts();
  }

  function manualRefreshCrypto(){ updateCryptoAndCharts(); }

  function formatNumber(n){
    if(typeof n !== 'number') n = Number(n) || 0;
    return n.toLocaleString('id-ID', {maximumFractionDigits:0});
  }

  // ----- Gold (local simulation) -----
  let goldChart;
  function renderGold(target){
    target.innerHTML = `
      <h2>Gold (Simulasi)</h2>
      <p class="muted">Data simulasi. Untuk harga real: gunakan provider harga komoditas (butuh API key).</p>
      <div style="max-width:700px"><canvas id="chartGOLD"></canvas></div>
      <div class="muted">Edit DATA.markets.GOLD.history untuk update.</div>
    `;
    const ctx = document.getElementById('chartGOLD').getContext('2d');
    const arr = DATA.markets.GOLD.history;
    if(goldChart) goldChart.destroy();
    goldChart = new Chart(ctx,{type:'line',data:{labels:arr.map((_,i)=>i+1),datasets:[{label:DATA.markets.GOLD.name,data:arr,borderColor:'#f4b400',fill:false}]},options:{plugins:{legend:{display:false}}}});
  }

  // ----- Markets (regional charts) -----
  let marketsCharts = {};
  function renderMarkets(target){
    target.innerHTML = `
      <h2>Regional Markets (Simulasi)</h2>
      <button class="btn" onclick="refreshMarkets()">Refresh (simulasi)</button>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px">
        <div class="card"><h4>IHSG (Indonesia)</h4><canvas id="mIHSG"></canvas></div>
        <div class="card"><h4>VN Index (Vietnam)</h4><canvas id="mVN"></canvas></div>
        <div class="card"><h4>SET (Thailand)</h4><canvas id="mTH"></canvas></div>
        <div class="card"><h4>STI (Singapore)</h4><canvas id="mSG"></canvas></div>
      </div>
      <div style="margin-top:10px" class="muted">Edit data di <b>DATA.markets</b> (history arrays). Charts akan me-render ulang saat tekan Refresh.</div>
    `;
    createMarketChart('mIHSG', DATA.markets.IHSG.history, DATA.markets.IHSG.name, '#420D09');
    createMarketChart('mVN', DATA.markets.VN.history, DATA.markets.VN.name, '#FF6B6B');
    createMarketChart('mTH', DATA.markets.TH.history, DATA.markets.TH.name, '#2196F3');
    createMarketChart('mSG', DATA.markets.SG.history, DATA.markets.SG.name, '#4CAF50');
  }

  function createMarketChart(canvasId, arr, label, color){
    const ctx = document.getElementById(canvasId).getContext('2d');
    if(marketsCharts[canvasId]) marketsCharts[canvasId].destroy();
    marketsCharts[canvasId] = new Chart(ctx, {
      type:'line',
      data:{labels:arr.map((_,i)=>i+1), datasets:[{label, data:arr, borderColor:color, fill:false, pointRadius:2}]},
      options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}
    });
  }

  function refreshMarkets(){ renderMarkets(document.getElementById('viewArea')); }

  function renderReports(target){
    const rows = DATA.reports.map(r=>`<tr><td>${r.month}</td><td>${r.revenue}</td><td>${r.note}</td></tr>`).join('');
    target.innerHTML = `<h2>Reports üìã</h2><table><thead><tr><th>Bulan</th><th>Pendapatan</th><th>Catatan</th></tr></thead><tbody>${rows}</tbody></table><div class="muted">Edit DATA.reports untuk ubah tabel</div>`;
  }

  function renderSettings(target){
    target.innerHTML = `
      <h2>Settings ‚öôÔ∏è</h2>
      <div class="card">
        <div style="display:flex;gap:10px;align-items:center">
          <label>Font size: </label>
          <select id="setFont" onchange="document.getElementById('fontSizeTop').value=this.value; applyFontSize();">
            <option value="14">14</option><option value="16" selected>16</option><option value="18">18</option><option value="20">20</option>
          </select>
        </div>
        <div style="margin-top:12px">
          <button class="btn" onclick="toggleDark()">Toggle Dark Mode</button>
        </div>
        <div style="margin-top:12px" class="muted">Note: Untuk menghubungkan data real (IHSG / regional / komoditas) gunakan API provider dan ganti bagian fetch di JS sesuai dokumentasi provider.</div>
      </div>
    `;
  }

  // helpers
  function applyFontSize(){
    const v = document.getElementById('fontSizeTop').value;
    document.documentElement.style.fontSize = v + 'px';
  }
  function toggleDark(){ document.documentElement.classList.toggle('dark'); }
  function logout(){ window.location.href = 'vvip.html'; }

  // initial load
  showContent('overview');

  // Make sidebar <a onclick="showContent('...')"> clickable with event listeners
  document.querySelectorAll('.sidebar a').forEach(a=>{
    a.addEventListener('click', (ev)=>{
      // extract parameter from onclick attr if present
      const onclick = a.getAttribute('onclick') || '';
      const match = onclick.match(/showContent\('([^']+)'\)/);
      if(match) { ev.preventDefault(); showContent(match[1]); return; }
      // else, some links are plain href (vvip-pro/plus) or toggles - handled separately
    });
  });

  // === Crypto auto start if user visits crypto page ===
  // expose functions for console/manual control:
  window.refreshMarkets = refreshMarkets;
  window.manualRefreshCrypto = manualRefreshCrypto;
  window.showContent = showContent;

  // NOTE about real-time indices:
  /*
    - Crypto live implemented via CoinGecko public API (no API key).
    - Live stock indices (IHSG, VN, SET, STI) require a market data provider (paid/free) with CORS-enabled endpoints.
      If you obtain an API endpoint (and key), replace DATA.markets.* logic or add a fetch() to retrieve real series,
      then update the corresponding chart data arrays and call chart.update().
    - If you want, beri aku API provider & key nanti aku bantu inject fetch code.
  */

  </script>
</body>
</html>
